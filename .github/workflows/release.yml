# ============================================================
#  OCRtoODT â€” GitHub Actions Release Workflow
#  File: .github/workflows/release.yml
#
#  Responsibility:
#      - Build Release binary on tag push (v*)
#      - Use SYSTEM dependencies (Qt6 + Poppler-Qt6 + OpenCV + Tesseract)
#      - Upload built executable as workflow artifact
#
#  Notes:
#      - Use ubuntu-22.04 explicitly because:
#          * libpoppler-qt6-dev is reliably available there
#          * stable dependency resolution
# ============================================================

name: Build Release (Linux)

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # --------------------------------------------------------
    # Checkout repository
    # --------------------------------------------------------
    - name: Checkout
      uses: actions/checkout@v4

    # --------------------------------------------------------
    # Install system dependencies
    # --------------------------------------------------------
    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install -y \
          build-essential \
          ninja-build \
          cmake \
          pkg-config \
          qt6-base-dev \
          qt6-tools-dev \
          qt6-multimedia-dev \
          libpoppler-qt6-dev \
          libopencv-dev \
          libtesseract-dev \
          libleptonica-dev

    # --------------------------------------------------------
    # Configure (Release)
    # --------------------------------------------------------
    - name: Configure
      run: |
        cmake -S . -B build \
          -G Ninja \
          -DCMAKE_BUILD_TYPE=Release

    # --------------------------------------------------------
    # Build
    # --------------------------------------------------------
    - name: Build
      run: |
        cmake --build build

    # --------------------------------------------------------
    # Upload binary artifact
    # --------------------------------------------------------
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: OCRtoODT-Linux
        path: build/OCRtoODT

